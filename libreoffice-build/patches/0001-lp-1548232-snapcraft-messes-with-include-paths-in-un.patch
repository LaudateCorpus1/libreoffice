From 0933c112fe3c5d7780702d487cd09ad9604eda04 Mon Sep 17 00:00:00 2001
From: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
Date: Wed, 8 Jun 2016 18:41:38 +0200
Subject: [PATCH 1/4] lp#1548232: snapcraft messes with include paths in
 unhealthy ways

---
 solenv/gbuild/extensions/final_FixNss.mk | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 solenv/gbuild/extensions/final_FixNss.mk

diff --git a/solenv/gbuild/extensions/final_FixNss.mk b/solenv/gbuild/extensions/final_FixNss.mk
new file mode 100644
index 0000000..d34c553
--- /dev/null
+++ b/solenv/gbuild/extensions/final_FixNss.mk
@@ -0,0 +1,13 @@
+$(WORKDIR)/CxxObject/oox/source/crypto/CryptTools.o: $(WORKDIR)/Headers/Library/libooxlo.so
+	#S=$(SRCDIR) && I=$$$S/instdir && W=$(WORKDIR) &&  mkdir -p $$$W/CxxObject/oox/source/crypto/ $$$W/Dep/CxxObject/oox/source/crypto/ && cd $(SRCDIR) &&   g++ -DBOOST_ERROR_CODE_HEADER_ONLY -DBOOST_SYSTEM_NO_DEPRECATED -DCPPU_ENV=gcc3 -DLINUX -DNDEBUG -DOPTIMIZE -DOSL_DEBUG_LEVEL=0 -DUNIX -DUNX -DX86_64 -D_PTHREADS -D_REENTRANT -I../../install/usr/include/nss -I../../install/include -I../../install/usr/include -I../../install/include/x86_64-linux-gnu -I../../install/usr/include/x86_64-linux-gnu -DOOX_DLLIMPLEMENTATION -DSYSTEM_NSS -DSYSTEM_NSS  -DHAVE_GCC_VISIBILITY_FEATURE -fvisibility=hidden   -Wall -Wno-missing-braces -Wnon-virtual-dtor -Wendif-labels -Wextra -Wundef -Wunused-macros -fmessage-length=0 -fno-common -pipe  -fvisibility-inlines-hidden -fstack-protector-strong -fPIC -Wshadow -Woverloaded-virtual -std=gnu++11   -DEXCEPTIONS_ON -fexceptions -fno-enforce-eh-specs -O2  -DLIBO_INTERNAL_ONLY  -c $$S/oox/source/crypto/CryptTools.cxx -o $$W/CxxObject/oox/source/crypto/CryptTools.o -MMD -MT $$W/CxxObject/oox/source/crypto/CryptTools.o -MP -MF $$W/Dep/CxxObject/oox/source/crypto/CryptTools.d_ -I$$S/oox/source/crypto/ -I$$W/UnpackedTarball/boost -I$$S/include -I/usr/lib/jvm/java-7-openjdk-amd64/include -I/usr/lib/jvm/java-7-openjdk-amd64/include/linux -I$$S/config_host -I$$W/CustomTarget/oox/generated -I$$S/oox/inc -I$$W/UnoApiHeadersTarget/udkapi/normal -I$$W/UnoApiHeadersTarget/offapi/normal -isystem ../../install/usr/include/nss -isystem ../../install/usr/include/nspr -isystem ../../install/usr/include/nss -isystem ../../install/usr/include/nspr -I/oox/inc  && mv $$W/Dep/CxxObject/oox/source/crypto/CryptTools.d_ $$W/Dep/CxxObject/oox/source/crypto/CryptTools.d
+	S=$(SRCDIR) && I=$$$S/instdir && W=$(WORKDIR) &&  mkdir -p $$W/CxxObject/oox/source/crypto/ $$W/Dep/CxxObject/oox/source/crypto/ && cd $(SRCDIR) &&   g++ -DBOOST_ERROR_CODE_HEADER_ONLY -DBOOST_SYSTEM_NO_DEPRECATED -DCPPU_ENV=gcc3 -DLINUX -DNDEBUG -DOPTIMIZE -DOSL_DEBUG_LEVEL=0 -DUNIX -DUNX -DX86_64 -D_PTHREADS -D_REENTRANT -I../../install/usr/include/nss -I../../install/include  -I../../install/include/x86_64-linux-gnu -I../../install/usr/include/x86_64-linux-gnu -DOOX_DLLIMPLEMENTATION -DSYSTEM_NSS -DSYSTEM_NSS  -DHAVE_GCC_VISIBILITY_FEATURE -fvisibility=hidden   -Wall -Wno-missing-braces -Wnon-virtual-dtor -Wendif-labels -Wextra -Wundef -Wunused-macros -fmessage-length=0 -fno-common -pipe  -fvisibility-inlines-hidden -fstack-protector-strong -fPIC -Wshadow -Woverloaded-virtual -std=gnu++11   -DEXCEPTIONS_ON -fexceptions -fno-enforce-eh-specs -O2  -DLIBO_INTERNAL_ONLY  -c $$S/oox/source/crypto/CryptTools.cxx -o $$W/CxxObject/oox/source/crypto/CryptTools.o -MMD -MT $$W/CxxObject/oox/source/crypto/CryptTools.o -MP -MF $$W/Dep/CxxObject/oox/source/crypto/CryptTools.d_ -I$$S/oox/source/crypto/ -I$$W/UnpackedTarball/boost -I$$S/include -I/usr/lib/jvm/java-7-openjdk-amd64/include -I/usr/lib/jvm/java-7-openjdk-amd64/include/linux -I$$S/config_host -I$$W/CustomTarget/oox/generated -I$$S/oox/inc -I$$W/UnoApiHeadersTarget/udkapi/normal -I$$W/UnoApiHeadersTarget/offapi/normal -isystem ../../install/usr/include/nss -isystem ../../install/usr/include/nspr -isystem ../../install/usr/include/nss -isystem ../../install/usr/include/nspr -I/oox/inc  && mv $$W/Dep/CxxObject/oox/source/crypto/CryptTools.d_ $$W/Dep/CxxObject/oox/source/crypto/CryptTools.d
+
+$(WORKDIR)/CxxObject/xmlsecurity/source/xmlsec/nss/nssinitializer.o: $(WORKDIR)/Headers/Library/libxsec_xmlsec.so
+	S=$(SRCDIR) && I=$$S/instdir && W=$$S/workdir &&  mkdir -p $$W/CxxObject/xmlsecurity/source/xmlsec/nss/ $$W/Dep/CxxObject/xmlsecurity/source/xmlsec/nss/ && cd $(SRCDIR) &&   g++ -DBOOST_ERROR_CODE_HEADER_ONLY -DBOOST_SYSTEM_NO_DEPRECATED -DCPPU_ENV=gcc3 -DLINUX -DNDEBUG -DOPTIMIZE -DOSL_DEBUG_LEVEL=0 -DUNIX -DUNX -DX86_64 -D_PTHREADS -D_REENTRANT -I../install/usr/include/ -I../install/include -I../install/include/x86_64-linux-gnu -I../install/usr/include/x86_64-linux-gnu -DXMLSEC_NO_XSLT -DSYSTEM_LIBXML -DSYSTEM_NSS -DXMLSEC_CRYPTO_NSS -DSYSTEM_NSS  -DHAVE_GCC_VISIBILITY_FEATURE -fvisibility=hidden   -Wall -Wno-missing-braces -Wnon-virtual-dtor -Wendif-labels -Wextra -Wundef -Wunused-macros -fmessage-length=0 -fno-common -pipe  -fvisibility-inlines-hidden -fstack-protector-strong -fPIC -Wshadow -Woverloaded-virtual -std=gnu++11   -DEXCEPTIONS_ON -fexceptions -fno-enforce-eh-specs -O2  -DLIBO_INTERNAL_ONLY  -c $$S/xmlsecurity/source/xmlsec/nss/nssinitializer.cxx -o $$W/CxxObject/xmlsecurity/source/xmlsec/nss/nssinitializer.o -MMD -MT $$W/CxxObject/xmlsecurity/source/xmlsec/nss/nssinitializer.o -MP -MF $$W/Dep/CxxObject/xmlsecurity/source/xmlsec/nss/nssinitializer.d_ -I$$S/xmlsecurity/source/xmlsec/nss/ -I$$W/UnpackedTarball/boost -I$$S/include -I/usr/lib/jvm/java-7-openjdk-amd64/include -I/usr/lib/jvm/java-7-openjdk-amd64/include/linux -I$$S/config_host -I$$S/xmlsecurity/inc -I$$S/xmlsecurity/source/xmlsec -I$$W/UnpackedTarball/xmlsec/include -I$$W/CustomTarget/officecfg/registry -I$$W/UnoApiHeadersTarget/udkapi/normal -I$$W/UnoApiHeadersTarget/offapi/normal -isystem ../../install/usr/include/libxml2 -isystem ../../install/usr/include/nss -isystem ../../install/usr/include/nspr -isystem ../../install/usr/include/nss -isystem ../../install/usr/include/nspr  && mv $$W/Dep/CxxObject/xmlsecurity/source/xmlsec/nss/nssinitializer.d_ $$W/Dep/CxxObject/xmlsecurity/source/xmlsec/nss/nssinitializer.d 
+
+#SRCDIR=/home/bjoern/checkouts/libreoffice-snap/parts/libreoffice-build/build/build
+
+#$(error remove include dirs: $(realpath $(SRCDIR)/../../../..)/stage/ $(realpath $(SRCDIR)/../../)/install/)
+
+#$(call gb_Library_get_target,xsec_xmlsec) : DEFS := $(filter-out -I$(realpath $(SRCDIR)/../../../..)/stage/% -I$$(realpath $(SRCDIR)/../../)%,$(DEFS))
+#$(call gb_Library_get_target,xsec_xmlsec) : INCLUDE := $(filter-out -I$(realpath $(SRCDIR)/../../../..)/stage/% -I$$(realpath $(SRCDIR)/../../)%,$(INCLUDE))
-- 
2.7.4

